<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="marketMain.css">
  <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
  <script src="../node_modules/sweetalert2/dist/sweetalert2.min.js"></script>
  <script src="../node_modules/jquery/dist/jquery.min.js"></script>
  <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <title>라임마켓</title>

  <script type="text/javascript">

    $(document).ready(function(){
        $('#footer').load('/footer/footer.html');
        $('#u-nav-bar').load('/header/user/header.html')
    })
  </script>
  
</head>
<body>
<nav id="u-nav-bar"></nav>
<div id="body-wrapper">
  <div id="market-content">
      <div class="container" id="market-nav-wrap">
        <div class="row" id="market-nav">
          <div class="col">
            <select name="region" id="region" onchange="regionChange(regionSelect.value);">
                <option selected disabled hidden>지역</option>
                <option value="전체">전체</option>
                <option value="서울특별시">서울특별시</option>
                <option value="부산광역시">부산광역시</option>
                <option value="대구광역시">대구광역시</option>
                <option value="인천광역시">인천광역시</option>
                <option value="광주광역시">광주광역시</option>
                <option value="대전광역시">대전광역시</option>
                <option value="울산광역시">울산광역시</option>
                <option value="세종특별자치시">세종특별자치시</option>
                <option value="경기도">경기도</option>
                <option value="강원도">강원도</option>
                <option value="충청북도">충청북도</option>
                <option value="충청남도">충청남도</option>
                <option value="전라북도">전라북도</option>
                <option value="전라남도">전라남도</option>
                <option value="경상북도">경상북도</option>
                <option value="경상남도">경상남도</option>
                <option value="제주도">제주도</option>
            </select>
          </div>
          <div class="col">
            <select name="city" id="city" onchange="cityChange(city.value);">
                <option selected hidden>도시</option>
            </select>
          </div>
          <div id="checkbox-wrap" class="col-2">
            <input id="nav-checkbox" type="checkbox"><label id="nav-c-label">거래가능만 보기</label>
          </div>
          <div class="col">
            <div class="search-bar">
              <input type="search" placeholder="검색어를 입력해주세요">
              <svg xmlns="http://www.w3.org/2000/svg" width="40" height="30" fill="rgb(190, 190, 190)" class="bi bi-search" viewBox="0 0 18 18">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
              </svg>
            </div>
          </div>
          <div id="market-write-wrap" class="col">
            <button id="market-write" name="btn123">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-pencil-square" viewBox="0 0 16 16">
                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
              </svg>글쓰기
            </button>
          </div>
        </div> <!-- market-nav -->
          
      </div> <!-- market-nav-wrap -->
  </div> <!-- market-content -->
  
  <div id="content-body">
    <div id="item-list" class="row row-cols-1 row-cols-sm-3 g-5"></div>
  </div>
  
  <footer id="footer"></footer>
</div> <!-- body-wrapper -->



<!-- 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 -->
 


<script>

var itemList = document.querySelector("#item-list");
var regionSelect = document.querySelector("#region");
var city = document.getElementById("city");


var seoul = ["도시","강남구","강동구","강북구","강서구","관악구","광진구","구로구","금천구","노원구","도봉구","동대문구","동작구","마포구","서대문구","서초구","성동구","성북구","송파구","양천구","영등포구","용산구","은평구","종로구","중구","중랑구"];
var busan = ["도시","강서구","금정구","남구","동구","동래구","부산진구","북구","사상구","사하구","서구","수영구","연제구","영도구","중구","해운대구","기장군"];
var daegu = ["도시","남구", "달서구", "동구", "북구", "서구", "수성구", "중구", "달성군"];
var incheon = ["도시","계양구","남구","남동구","동구","부평구","서구","연수구","중구","강화군","옹진군"];
var gwangju = ["도시","광산구", "남구", "동구", "북구", "서구"];
var daejeon = ["도시","대덕구", "동구", "서구", "유성구", "중구"];
var ulsan = ["도시","남구","동구","북구","중구","울주군"];
var sejong = ["세종특별자치시"];
var gyeonggi = ["도시","고양시","과천시","광명시","광주시","구리시","군포시","김포시","남양주시","동두천시","부천시","성남시","수원시","시흥시","안산시","안성시","안양시","양주시","오산시","용인시","의왕시","의정부시","이천시","파주시","평택시","포천시","하남시","화성시","가평군","양평군","여주군","연천군"];
var gangwon = ["도시","강릉시","동해시","삼척시","속초시","원주시","춘천시","태백시","고성군","양구군","양양군","영월군","인제군","정선군","철원군","평창군","홍천군","화천군","횡성군"];
var chungbuk = ["도시","제천시","청주시","충주시","괴산군","단양군","보은군","영동군","옥천군","음성군","증평군","진천군","청원군"];
var chungnam = ["도시","계룡시","공주시","금산군","논산시","당진시","보령시","부여군","서산시","서천군","아산시","예산군","천안시","청양군","태안군","홍성군"];
var jeonbuk = ["도시","군산시", "김제시", "남원시", "익산시", "전주시", "정읍시", "고창군", "무주군", "부안군", "순창군", "완주군", "임실군", "장수군", "진안군"];
var jeonnam = ["도시","광양시","나주시","목포시","순천시","여수시","강진군","고흥군","곡성군","구례군","담양군","무안군","보성군","신안군","영광군","영암군","완도군","장성군","장흥군","진도군","함평군","해남군","화순군"];
var gyeongbuk = ["도시","경산시","경주시","구미시","김천시","문경시","상주시","안동시","영주시","영천시","포항시","고령군","군위군","봉화군","성주군","영덕군","영양군","예천군","울릉군","울진군","의성군","청도군","청송군","칠곡군"];
var gyeongnam = ["도시","거제시", "김해시", "밀양시", "사천시", "양산시", "진주시", "진해시", "창원시", "통영시", "거창군", "고성군", "남해군", "산청군", "의령군", "창녕군", "하동군", "함안군", "함양군", "합천군"];
var jeju = ["도시","서귀포시","제주시"];


$(document).ready(function(e){
            
    // 버튼을 동적연결한다.
    $(document).on("click", ".heart-click", function(){
        let no = $(this).attr("idx");

        if ($(this).children("svg").attr("class") == "bi bi-heart") {
          fetch(`/like/list?itemId=${no}&done=${true}`)
          .then(function(response) {
            return response.text();
          })
          .then(function(result) {
            console.log(result);
          });

          $(this).children("svg").toggleClass("bi-heart-fill");
          $(this).html(`<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="rgb(146, 219, 130)" class="bi bi-heart-fill" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>`)
        }
        else if ($(this).children("svg").attr("class") == "bi bi-heart-fill") {
          fetch(`/like/list?itemId=${no}&done=${false}`)
          .then(function(response) {
            return response.text();
          })
          .then(function(result) {
            console.log(result);
          });

          $(this).children("svg").toggleClass("bi-heart");
          $(this).html(`<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-heart" viewBox="0 0 16 16">
            <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/></svg>`)
        }
    });
});


function listFetch() {
  $("div[name=card-col]").remove();
  $("div[id=empty-notice]").remove();
  fetch(`/market/list?regionName=${regionSelect.value}&cityName=${city.value}&checked=${$("#nav-checkbox").is(":checked")}
  &keyword=${$("input[type=search]").val()}`)
  .then(function(response){
    return response.json();
  })
  .then(function(lists){
    if (lists.status == "fail") {
      window.alert("서버 요청 오류!");
      return;
    }
    if (lists.data.length == 0) {
      var emptyNotice = document.createElement("div");
      emptyNotice.setAttribute('id', 'empty-notice');
      emptyNotice.innerHTML = `<p>찾으시는 물건이 없습니다!</p>`
      itemList.appendChild(emptyNotice);
    }
    console.log(lists.data);
    for (var list of lists.data) {
      let transState1 = list.transState;
      if (transState1 == "S") {
      transState1 = "";
      }
      else if (transState1 == "R") {
        transState1 = `<span class="R">예약중</span>`;
      }
      else if (transState1 == "E") {
        transState1 = `<span class="E">거래완료</span>`;
      }

      var cols = document.createElement("div");
      cols.setAttribute('class', 'col');
      cols.setAttribute('name', 'card-col');
      cols.innerHTML = `<div class="card h-100" item-id=${list.itemId}>
      <img src="../ok_photo.jfif" class="card-img-top" alt="...">
      <a class="heart-click" idx=${list.itemId}><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-heart" viewBox="0 0 16 16">
  <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
</svg></a>
      <div class="card-body">
        <h5 class="card-title"><a href="${list.itemName}">${list.itemName}</a></h5>
        <span class="item-price">${list.itemCost}원 ${transState1}</span><br>
        <span>${list.regionName} ${list.cityName}</span><br>
        <span class="view-count">조회 ${list.viewCount}</span>
      </div>
      </div>`
      itemList.appendChild(cols);
    }      
})
}


listFetch(); // 첫 화면

// 지역 선택
var regionChange = function(value) {
  
  if (value == "서울특별시") {
    add = seoul;
  } else if (value == "부산광역시") {
    add = busan;
  } else if (value == "대구광역시") {
    add = daegu;
  } else if (value == "인천광역시") {
    add = incheon;
  } else if (value == "광주광역시") {
    add = gwangju;
  } else if (value == "대전광역시") {
    add = daejeon;
  } else if (value == "울산광역시") {
    add = ulsan;
  } else if (value == "세종특별자치시") {
    add = sejong;
  } else if (value == "경기도") {
    add = gyeonggi;
  } else if (value == "강원도") {
    add = gangwon;
  } else if (value == "충청북도") {
    add = chungbuk;
  } else if (value == "충청남도") {
    add = chungnam;
  } else if (value == "전라북도") {
    add = jeonbuk;
  } else if (value == "전라남도") {
    add = jeonnam;
  } else if (value == "경상북도") {
    add = gyeongbuk;
  } else if (value == "경상남도") {
    add = gyeongnam;
  } else if (value == "제주도") {
    add = jeju;
  } else if(value == "전체") {
    add = ["도시"];
  }
  city.options.length = 1;

  for (property in add) {
    let opt = document.createElement("option");
    opt.value = add[property];
    opt.innerHTML = add[property];
    city.appendChild(opt);
  }

  listFetch();

}

// 도시 선택
var cityChange = function(value){
  listFetch();
  }

// 거래가능만 보기
$("#nav-checkbox").on("change", function(){
  console.log($("#nav-checkbox").is(":checked"));
  listFetch();
});

// 검색
$("input[type=search]").keyup(function(e) {
    if (e.keyCode == 27) {
      $(e.target).val("");

    } else if (e.keyCode == 13) {
      if ($(e.target).val() == "") {
        window.alert("검색어를 입력해주세요.");
        //Swal.fire("필수 입력 항목이 비어 있습니다.");
        return;
      }
      console.log($(e.target).val());
      console.log($("input[type=search]").val());
      listFetch();
      
    }
  })

</script>
</body>
</html>
