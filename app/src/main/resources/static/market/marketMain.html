<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>MarketMain</title>
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="marketMain.css">
  <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
</head>
<body>
<div id="market-content">
    <nav id="market-nav">
        <select name="region" id="region" onchange="selectBoxChange(regionSelect.value);">
            <option>지역</option>
            <option value="서울특별시">서울특별시</option>
            <option value="부산광역시">부산광역시</option>
            <option value="대구광역시">대구광역시</option>
            <option value="인천광역시">인천광역시</option>
            <option value="광주광역시">광주광역시</option>
            <option value="대전광역시">대전광역시</option>
            <option value="울산광역시">울산광역시</option>
            <option value="세종특별자치시">세종특별자치시</option>
            <option value="경기도">경기도</option>
            <option value="강원도">강원도</option>
            <option value="충청북도">충청북도</option>
            <option value="충청남도">충청남도</option>
            <option value="전라북도">전라북도</option>
            <option value="전라남도">전라남도</option>
            <option value="경상북도">경상북도</option>
            <option value="경상남도">경상남도</option>
        </select>
        <select name="city" id="city">
            <option>도시</option>
            <option value="서울특별시">서울특별시</option>
        </select>
    </nav>
</div>
<div id="content-body" class="row row-cols-1 row-cols-md-3 g-4">
  
    
</div>



<!-- 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 -->
 
<script src="../node_modules/sweetalert2/dist/sweetalert2.min.js"></script>
<script src="../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<script>

var contentBody = document.querySelector("#content-body")
var contentBody2 = document.querySelector("#content-body2")
  
  // fetch("/market/list")
  //   .then(function(response) {
  //     return response.json();
  //   })
  //   .then(function(lists) {
  //      for (var list of lists) {
  //        var div = document.createElement("div");
  //        div.setAttribute('id','div-remove');
  //        div.innerHTML = `<div class="card h-100">
  //         <img src="../ok_photo.jfif" class="card-img-top" alt="...">
  //         <div class="card-body">
  //           <h5 class="card-title"><a href="${list.itemName}">${list.itemName}</a></h5>
  //           <p>${list.itemCost}원</p><p>${list.transState}</p>
  //           <p>${list.regionName} ${list.cityName}</p>
  //           <p>조회 ${list.viewCount}</p>
  //         </div>
  //         </div>`
  //         contentBody.appendChild(div);
  //      }
  //   });

    var regionSelect = document.querySelector("#region");
  
    fetch(`/market/list`)
      .then(function(response){
        return response.json();
      })
      .then(function(lists){
        console.log(lists);
        
        for (var list of lists) {
          let transState1 = list.transState;
          if (transState1 == "S") {
          transState1 = "";
        }
        else if (transState1 == "R") {
          transState1 = `<span class="R">예약중</span>`;
        }
        else if (transState1 == "E") {
          transState1 = `<span class="E">거래완료</span>`;
        }

         var cols = document.createElement("div");
         cols.setAttribute('class', 'col');
         cols.innerHTML = `<div class="card h-100">
          <img src="../ok_photo.jfif" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><a href="${list.itemName}">${list.itemName}</a></h5>
            <span class="item-price">${list.itemCost}원 ${transState1}</span><br>
            <span>${list.regionName} ${list.cityName}</span><br>
            <span class="view-count">조회 ${list.viewCount}</span>
          </div>
          </div>`
          contentBody.appendChild(cols);
        }
        
      })

      var selectBoxChange = function(value){
       $(".col").remove();
        if(value == "지역") {
          fetch(`/market/list`)
          .then(function(response){
            return response.json();
          })
          .then(function(lists){
            console.log(lists);
            
            for (var list of lists) {
              let transState1 = list.transState;
              if (transState1 == "S") {
              transState1 = "";
            }
            else if (transState1 == "R") {
              transState1 = `<span class="R">예약중</span>`;
            }
            else if (transState1 == "E") {
              transState1 = `<span class="E">거래완료</span>`;
            }

            var cols = document.createElement("div");
            cols.setAttribute('class', 'col');
            cols.innerHTML = `<div class="card h-100">
              <img src="../ok_photo.jfif" class="card-img-top" alt="...">
              <div class="card-body">
                <h5 class="card-title"><a href="${list.itemName}">${list.itemName}</a></h5>
                <span class="item-price">${list.itemCost}원 ${transState1}</span><br>
                <span>${list.regionName} ${list.cityName}</span><br>
                <span class="view-count">조회 ${list.viewCount}</span>
              </div>
              </div>`
              contentBody.appendChild(cols);
            }
            
          })
        }
        console.log(value);
        fetch(`/market/list/region?regionName=${regionSelect.value}`)
        .then(function(response){
          return response.json();
        })
        .then(function(regionData){
          console.log(regionData);
          
          for (var list of regionData) {
            console.log(list.transState);
            let transState1 = list.transState;
            if (transState1 == "S") {
            transState1 = "";
          }
          else if (transState1 == "R") {
            transState1 = `<span class="R">예약중</span>`;
          }
          else if (transState1 == "E") {
            transState1 = `<span class="E">거래완료</span>`;
          }
          var cols = document.createElement("div");
          cols.setAttribute('class', 'col');
          cols.innerHTML = `<div class="card h-100">
            <img src="../ok_photo.jfif" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title"><a href="${list.itemName}">${list.itemName}</a></h5>
              <span class="item-price">${list.itemCost}원 ${transState1}</span><br>
              <span>${list.regionName} ${list.cityName}</span><br>
              <span class="view-count">조회 ${list.viewCount}</span>
            </div>
            </div>`
            contentBody.appendChild(cols);
          }
          
        })
      }



// fetch(`/market/list?${qs}`)
//       .then(function(response) {
//         return response.text();
//       })
//       .then(function(text) {
//         console.log(text);
//         location.href = "index.html";
//       });

//     $("#region").change(function() {
//         if ($(this).val() == "광주광역시") {
//             alert($(this).val());
//         }
//     });
</script>
</body>
</html>
