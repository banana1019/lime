<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="manageUser.css">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link rel="stylesheet" href="/header/header.css">
    <link rel="stylesheet" href="../header/header.css">
</head>
<style>
  #x-table {
    margin-top: 30%;
    padding: auto;
  }


  #pagingul {

    border: 1px solid #ccc;
    background-color: #ccc;
    border-right: 0;
  }
  #pagingul div {
    text-align: center;
    float: left;
    background-color: red;
    border: 1px solid #ccc;
    width: 10%;
  }

</style>
<body>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-8">
        <div id="tables" class="table-responsive">
            <table id="x-table" class="table table-striped table-hover table-bordered border-primary text-center" ">
              <thead>
                <tr id="x-thead">
                  <th scope="col"><input type="checkbox"></th>
                  <th scope="col">번호</th>
                  <th scope="col">이름</th>
                  <th scope="col">이메일</th>
                  <th scope="col">회원유형</th>
                  <th scope="col">가입일자</th>
                  <th scope="col">라임캐시</th>
                  <th scope="col">상세</th>
                </tr>
              </thead>
            <tbody id ="x-tbody">
            </tbody>
          </table>
        </div>
        <div class="row justify-content-center" id="pagingul">
        </div>
      </div>
    </div>
  </div>

<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script type="text/javascript">

var xTbody = document.querySelector("#x-tbody");
let totalData; //총 데이터 수
let dataPerPage = 10; //한 페이지에 나타낼 글 수
let pageCount = 10; //페이징에 나타낼 페이지 수
let globalCurrentPage=1; //현재 페이지 

fetch(`/manage/user/list`)
.then(function(response){
  return response.json();
})
.then(function(manages){
  console.log(manages);
  var content= '';
  for(var manage of manages){
    console.log(manage)

      content+= `
        <tr id = "xTr">
          <th scope="row">
            <input type="checkbox">
          </th>
          <td id="x-no">${manage.no}</td>
          <td>${manage.name}</td>
          <td>${manage.email}</td>
          <td>${manage.userType}</td>
          <td>${manage.rgtDate}</td>
          <td>${manage.sum}</td>
          <td><button id="detailBtn"  class="btn btn-outline-success" type="button" value= "${manage.no}">상세</td>
        </tr>`

    }
    xTbody.innerHTML =content
  });
 

  $(document).ready(function () {
       // $("#x-header").load("/header/admin/header.html");  //헤더 인클루드&ndash;&gt;
       // $("#x-header").load("/header/manager/header.html");  //헤더 인클루드&ndash;&gt;
       // $("#sidebar").load("/header/sidebar/sidebar.html");  //헤더 인클루드-->

       fetch(`/manage/user/userCount`)
       .then(function(response){
         return response.json();
       }).then(function(userCount){
        totalData = userCount.userCount;

        console.log(totalData);
        console.log(dataPerPage);
        console.log(pageCount);

      //displayData(1, dataPerPage);
 
      //페이징 표시 호출
        paging(totalData, dataPerPage, pageCount, 1);
        });


      $(document).on("click", "button[id='detailBtn']", function () {

          location.href = "userDetail.html?no=" +$(this).val();

      }); 
    });


    function paging(totalData, dataPerPage, pageCount, currentPage) {
        console.log("currentPage : " + currentPage);

  totalPage = Math.ceil(totalData / dataPerPage); //총 페이지 수
  
  if(totalPage<pageCount){
    pageCount=totalPage;
  }
  
  let pageGroup = Math.ceil(currentPage / pageCount); // 페이지 그룹
  let last = pageGroup * pageCount; //화면에 보여질 마지막 페이지 번호
  
  if (last > totalPage) {
    last = totalPage;
  }

  let first = last - (pageCount - 1); //화면에 보여질 첫번째 페이지 번호
  let next = last + 1;
  let prev = first - 1;

  let pageHtml = "";

  if (prev > 0) {
    pageHtml += "<li><a href='#' id='prev'> 이전 </a></li>";
  }

 //페이징 번호 표시 
  for (var i = first; i <= last; i++) {
    if (currentPage == i) {
      pageHtml +="<button type=`button` class=`col` id=`"+ i +"`>" + i + "</button>";
    } else {
      pageHtml += "<button type=`button` class=`col` ><a href='#' id='" + i + "'>" + i + "</a></button>";
    }
  }

  if (last < totalPage) {
    pageHtml += "<li><a href='#' id='next'> 다음 </a></li>";
  }

  $("#pagingul").html(pageHtml);
  let displayCount = "";
  displayCount = "현재 1 - " + totalPage + " 페이지 / " + totalData + "건";
  $("#displayCount").text(displayCount);


  //페이징 번호 클릭 이벤트 
  $("#pagingul button").click(function () {
    
    let $id = $(this).attr("id");
    selectedPage = $(this).text();

    if ($id == "next") selectedPage = next;
    if ($id == "prev") selectedPage = prev;
    
    //전역변수에 선택한 페이지 번호를 담는다...
    globalCurrentPage = selectedPage;
    //페이징 표시 재호출
    paging(totalData, dataPerPage, pageCount, selectedPage);
    //글 목록 표시 재호출
    //displayData(selectedPage, dataPerPage);
  });
}





</script>
</body>
</html>